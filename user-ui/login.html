<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kloudy Login</title>
  <link rel="icon" type="image/png" href="/KloudyAiChatFavicon.png">
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      margin: 0; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex; 
      min-height: 100vh; 
      align-items: center; 
      justify-content: center; 
      padding: 20px;
    }
    .card { 
      width: 480px; 
      background: #fff; 
      border: 1px solid #e5e7eb; 
      border-radius: 16px; 
      padding: 40px; 
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
    }
    h2 { 
      margin: 0 0 24px 0; 
      font-size: 28px;
      font-weight: 700;
      text-align: center;
      color: #1f2937;
    }
    .row { 
      display: flex; 
      gap: 12px; 
      margin: 16px 0; 
      align-items: center;
    }
    input { 
      width: 100%; 
      padding: 16px; 
      border: 2px solid #d1d5db; 
      border-radius: 8px; 
      font-size: 16px;
      transition: border-color 0.3s ease;
    }
    input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    button { 
      width: 100%; 
      padding: 16px; 
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: #fff; 
      border: none; 
      border-radius: 8px; 
      cursor: pointer; 
      margin-top: 20px; 
      font-size: 16px;
      font-weight: 600;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
    }
    .muted { 
      color: #6b7280; 
      font-size: 14px; 
      text-align: center; 
      margin-top: 20px; 
    }
    a { 
      color: #3b82f6; 
      text-decoration: none; 
      font-weight: 500;
    }
    a:hover {
      text-decoration: underline;
    }
    .terms { 
      font-size: 14px; 
      color: #374151; 
      line-height: 1.5;
    }
    .captcha-container {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px;
      background: #f9fafb;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }
    .captcha-container span {
      font-size: 18px;
      font-weight: 600;
      color: #374151;
    }
    .captcha-container input {
      width: 80px;
      text-align: center;
      font-size: 16px;
      font-weight: 600;
    }
    .checkbox-container {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin: 20px 0;
    }
    .checkbox-container input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin: 0;
    }
    .checkbox-container label {
      font-size: 14px;
      line-height: 1.5;
      color: #374151;
    }
  </style>
  <script>
    function legalOk(){ return document.getElementById('legal').checked; }
    function genCaptcha(){
      const a = Math.floor(Math.random()*8)+1; const b = Math.floor(Math.random()*8)+1;
      document.getElementById('capA').textContent = a; document.getElementById('capB').textContent = b;
    }
    async function login(){
      if(!legalOk()){ alert('Please agree to legal terms.'); return; }
      const identifier = document.getElementById('identifier').value.trim();
      const password = document.getElementById('password').value.trim();
      const a = Number(document.getElementById('capA').textContent);
      const b = Number(document.getElementById('capB').textContent);
      const answer = Number(document.getElementById('capAns').value);
      const res = await fetch('/api/auth/login', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ identifier, password, captcha:{a,b,answer} }) });
      if(!res.ok){ const j = await res.json().catch(()=>({})); alert(j.error||'Invalid credentials'); genCaptcha(); return; }
      const data = await res.json();
      if (data.role === 'admin') {
        window.location.href = 'http://localhost:8717/rep-assistant.html';
      } else {
        window.location.href = '/user-app.html';
      }
    }
    function toRegister(){ window.location.href = '/user-app.html#register'; }
    async function forgotPassword(){
      const identifier = prompt('Enter your email, phone, or username:'); if(!identifier) return;
      const r = await fetch('/api/auth/forgot', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ identifier }) });
      const j = await r.json(); if(!j.success){ alert(j.error||'User not found'); return; }
      const answer = prompt(`Security Question (${j.securityQuestion}):`); if(!answer) return;
      const newPassword = prompt('Enter new password:'); if(!newPassword) return;
      const rr = await fetch('/api/auth/reset', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ identifier, securityAnswer: answer, newPassword }) });
      const jj = await rr.json(); if(!jj.success){ alert(jj.error||'Reset failed'); return; }
      alert('Password reset. Please login.');
    }
  </script>
</head>
<body>
  <div class="card">
    <h2>Welcome to Kloudy</h2>
    <div class="row"><input id="identifier" placeholder="Email, Phone or Username" value="johnny"/></div>
    <div class="row"><input id="password" type="password" placeholder="Password" value="@Waken19142025"/></div>
    <div class="captcha-container">
      <span id="capA">1</span> + <span id="capB">2</span> = <input id="capAns" placeholder="?"/>
      <a href="#" onclick="genCaptcha();return false;">refresh</a>
    </div>
    <div class="checkbox-container">
      <input type="checkbox" id="legal" checked/>
      <label for="legal">I agree that I am bound by all applicable legal terms, privacy, HIPAA and SOC 2 practices, disclosures, and updates across United Family Caregivers and affiliated sites/apps.</label>
    </div>
    <button onclick="login()">Sign in</button>
    <div class="muted">No account? <a href="#" onclick="toRegister()">Quick registration</a> â€¢ <a href="#" onclick="forgotPassword()">Forgot password?</a></div>
  </div>
  <script>genCaptcha();</script>
</body>
</html>
